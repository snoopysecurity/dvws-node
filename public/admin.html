<head>

   <script src="static/jquery-1.11.1.min.js"></script>
   <script type="text/javascript" src="static/angular.js"></script>
   <link href="static/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
   <script src="static/bootstrap.min.js"></script>
   <link href="index.css" rel="stylesheet" id="inline-css">
   <!------ Include the above in your HEAD tag ---------->

</head>

<body>
   <div class="sidenav">
      <div class="login-main-text">
         <h2>Damn Vulnerable Web Services<br> Admin Area</h2>
         <p>Functionality only available to Admin Users</p>
         <br>
         <a href="home.html" class="btn btn-secondary">Back to Home</a>
         <p></p>
      </div>
   </div>
   <div class="main">
      <div class="col-md-6 col-sm-12">
         <div class="login-form">
            <div ng-app="app" ng-controller="MyController">
               <h2>DVWS User Data</h2>
               <p>User Information: {{ ResponseMessage  }}</p>

               <p>System Information (OS): {{ SysMessage  }}</p>
               
               <br>
               <h3>Admin Tools</h3>
               <p>
                  <a href="admin_user_status.html" class="btn btn-black">Check User Status (Legacy SOAP)</a><br><br>
                  <a href="admin_create_user.html" class="btn btn-black">Create User</a><br><br>
                  <a href="admin_logs.html" class="btn btn-black">View Login Activity Logs</a>
               </p>
            </div>
         </div>
      </div>
      <p>
         <button class="btn btn-black" id="send">Show Your JWT Token</button>
      </p>
      <iframe id="receiver" src="/receiver.html" width="700" height="60">
         <p>Your browser does not support iframes.</p>
      </iframe>
      <script src="static/userdisplay.js"></script>



   </div>



   <script type="text/javascript">


      var app = angular.module('app', [])
      app.controller('MyController', function ($scope, $http, $window) {
         getFromServer();
         function getFromServer() {
            var get = $http({
               method: "GET",
               url: "/api/v2/users/checkadmin",
               dataType: 'json',
               headers: { "Content-Type": "application/json" },
               headers: { 'Authorization': 'Bearer ' + localStorage.getItem('JWTSessionID') }

            });

            get.success(function (data, status) {
               if (data.Success) {
                  $scope.ResponseMessage = data.Success
                  var adUrl = data.AdminURL
                  getSysInfo();



               } else if (data.Error) {
                  var user = data.User
                  $scope.ResponseMessage = data.Error
                  window.location = "home.html#" + user

               }

               get.error(function (data, status) {
                  $scope.ResponseMessage = 'Authentication Error';
               });

            });

         }

         function getSysInfo() {
            var get = $http({
               method: "GET",
               url: "/api/v2/sysinfo/uname",
               dataType: 'json',
               headers: { "Content-Type": "application/json" },
               headers: { 'Authorization': 'Bearer ' + localStorage.getItem('JWTSessionID') }

            });

            get.success(function (data, status) {
               $scope.SysMessage = data;
            });

         }

         // CheckStatus logic moved to admin_user_status.html

      });

   </script>


</body>


<!-- get all user data API functionality currently disabled-->
