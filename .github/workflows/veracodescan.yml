name: Veracode Upload And Scan
uses: veracode/veracode-uploadandscan-action@0.2.1
on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
jobs:
  veracodescan:
    runs-on: ubuntu-latest
    name: veracodescan check
    steps:
    - uses: actions/setup-java@v1 # Make java accessible on path so the uploadandscan action can run.
      with: 
        java-version: '8'
- uses: actions/upload-artifact@v2 # Copy files from repository to docker container so the next uploadandscan action can access them.
  with:
    path: dvws-node/* # Wildcards can be used to filter the files copied into the container. See: https://github.com/actions/upload-artifact
- uses: veracode/veracode-uploadandscan-action@master # Run the uploadandscan action. Inputs are described above.
  with:
    filepath: 'dvws-node/'
    vid: '${{ secrets.VERACODE_API_ID }}'
    vkey: '${{ secrets.VERACODE_API_KEY }}'
    createsandbox: 'true'
    sandboxname: 'SANDBOXNAME'
    scantimeout: 15
    criticality: 'VeryHigh'